# v3.0.0 - VIP 가입 로그 저장 기능 추가 및 스프링 DI로 상태 공유 문제 해결

## 📆 날짜
2025-07-15


### 📎 요구사항

- 회원 가입 시 로그 저장 기능을 추가한다.
- VIP 회원 가입 시 `[VIP 가입] {이름}` 로그를 저장한다.
- 로그는 서비스 전역에서 공유되어야 하며, `/logs` API를 통해 조회 가능해야 한다.

---

### ⚠️ 문제 상황

- 개발자는 `LogService`, `InMemoryLogRepository`를 직접 `new`로 생성하여 의존성을 주입하였다.
- 그 결과 `MemberService`, `LogController`가 서로 다른 `LogService` 인스턴스를 사용하게 되었고,
- VIP 가입 시 저장된 로그가 `/logs` API에서 조회되지 않는 문제가 발생했다.

---

### 🎯 문제의 정확한 원인

- 상태를 가지는 `InMemoryLogRepository`가 여러 인스턴스로 생성됨 → 로그 저장이 분산됨
- 스프링 컨테이너를 사용하지 않고 `new` 키워드로 직접 객체를 생성하면,
  → 스프링이 제공하는 **싱글톤 관리 및 DI 기능을 우회**하게 되어 상태 공유가 불가능해짐

---

### 🔧 해결 방향

- `LogRepository`, `LogService`를 모두 **스프링 빈(@Bean)** 으로 등록하여 **싱글톤 보장**
- `MemberService`, `LogController`는 생성자 주입을 통해 동일한 `LogService` 인스턴스를 공유
- 이로써 상태가 올바르게 공유되고, 로그 저장/조회 기능이 일관되게 동작하게 됨
- `/logs` 엔드포인트를 통해 VIP 가입 로그가 JSON으로 응답됨

---

## 💬 참고 강의
- 김영한 - 스프링 핵심 원리 - 기본편 (섹션 5. 스프링 컨테이너와 스프링 빈)
