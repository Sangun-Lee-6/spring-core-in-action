# v3.2.0 - @Profile κΈ°λ° λΉ λ¶„κΈ° ν…μ¤νΈ: BeanFactory vs ApplicationContext

## π“† λ‚ μ§

2025-07-16

---

### π“ μ”κµ¬μ‚¬ν•­

- λ™μΌν• `MessageProvider` μΈν„°νμ΄μ¤μ— λ€ν•΄

  ν™κ²½μ— λ”°λΌ μ„λ΅ λ‹¤λ¥Έ κµ¬ν„μ²΄λ¥Ό μ£Όμ…ν•΄μ•Ό ν•λ‹¤.

    - `dev` ν™κ²½: `DevMessageProvider`
    - `prod` ν™κ²½: `ProdMessageProvider`
- `@Profile` μ• λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ—¬ **ν™κ²½ κΈ°λ°μΌλ΅ λΉμ„ λ“±λ΅**ν•  μ μμ–΄μ•Ό ν•λ©°,
- `BeanFactory`μ™€ `ApplicationContext` κ°„μ μ°¨μ΄λ¥Ό λ…ν™•ν κ²€μ¦ν•  μ μμ–΄μ•Ό ν•λ‹¤.

---

### β οΈ λ¬Έμ  μƒν™©

μ•„λμ™€ κ°™μ΄ `BeanFactory`λ§μ„ μ‚¬μ©ν•μ—¬ `@Profile`μ΄ λ¶™μ€ λΉμ„ λ“±λ΅ν•λ©΄:

β‡’ `NoSuchBeanDefinitionException` λ°μƒ

```java
DefaultListableBeanFactory beanFactory = new DefaultListableBeanFactory();
AnnotatedBeanDefinitionReader reader = new AnnotatedBeanDefinitionReader(beanFactory);

reader.register(DevMessageProvider.class);
reader.register(ProdMessageProvider.class);

beanFactory.getBean(MessageProvider.class); // β μμ™Έ λ°μƒ

```

---

### π― λ¬Έμ μ μ •ν™•ν• μ›μΈ

- `BeanFactory`λ” λ§¤μ° λ‹¨μν• DI μ»¨ν…μ΄λ„μ΄κΈ° λ•λ¬Έμ— `Environment`κ°€ μ΅΄μ¬ν•μ§€ μ•μ
- λ”°λΌμ„ `@Profile("dev")` λ” λ¬΄μ‹λμ–΄ λΉ λ“±λ΅μ΄ λμ§€ μ•μ
- β†’ `MessageProvider` μΈν„°νμ΄μ¤μ κµ¬ν„μ²΄κ°€ μ»¨ν…μ΄λ„μ— μ΅΄μ¬ν•μ§€ μ•μ

---

### π”§ ν•΄κ²° λ°©ν–¥

β… ApplicationContext μ‚¬μ©μΌλ΅ μ „ν™

1. `AnnotationConfigApplicationContext`λ¥Ό μ‚¬μ©ν•΄ `Environment` μ„¤μ • κ°€λ¥
2. `setActiveProfiles("dev")`λ¥Ό ν†µν•΄ ν„μ¬ ν™μ„± ν”„λ΅νμΌμ„ μ§€μ •
3. `refresh()` νΈμ¶ μ‹ `@Profile` μ΅°κ±΄μ„ λ°μν•μ—¬ **μ¬λ°”λ¥Έ κµ¬ν„μ²΄λ§ λ“±λ΅**

---

### β… μ£Όμ” κµ¬ν„

### 1. μΈν„°νμ΄μ¤ μ •μ

```java
public interface MessageProvider {
    String getMessage();
}
```

---

### 2. ν™κ²½λ³„ κµ¬ν„μ²΄

```java
@Profile("dev")
@Component
public class DevMessageProvider implements MessageProvider {
    public String getMessage() { return "[DEV] κ°λ° ν™κ²½μ…λ‹λ‹¤."; }
}

@Profile("prod")
@Component
public class ProdMessageProvider implements MessageProvider {
    public String getMessage() { return "[PROD] μ΄μ ν™κ²½μ…λ‹λ‹¤."; }
}
```

---

### 3. ApplicationContext κΈ°λ° ν…μ¤νΈ

```java
AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext();
context.getEnvironment().setActiveProfiles("dev");
context.register(DevMessageProvider.class, ProdMessageProvider.class);
context.refresh();

MessageProvider provider = context.getBean(MessageProvider.class);

assertThat(provider).isInstanceOf(DevMessageProvider.class);
assertThat(provider.getMessage()).isEqualTo("[DEV] κ°λ° ν™κ²½μ…λ‹λ‹¤.");
```

---

### 4. μλ„μ  μ‹¤ν¨ ν…μ¤νΈ

```java
assertThatThrownBy(() -> {
    assertThat(provider).isInstanceOf(ProdMessageProvider.class);
}).isInstanceOf(AssertionError.class);
```

β†’ ν„μ¬ `dev` ν”„λ΅νμΌμ΄κΈ° λ•λ¬Έμ— `ProdMessageProvider`λ” λ“±λ΅λμ§€ μ•μ

β†’ μλ»λ νƒ€μ… κΈ°λ€ μ‹ `AssertionError` λ°μƒ β†’ ν…μ¤νΈλ” μ„±κ³µμ μΌλ΅ μ‹¤ν¨λ¥Ό κ²€μ¦

---

### π§  BeanFactory vs ApplicationContext μ°¨μ΄

| ν•­λ© | BeanFactory | ApplicationContext |
| --- | --- | --- |
| `@Profile` μ§€μ› | β λ―Έμ§€μ› (Environment μ—†μ) | β… μ§€μ› (Environment λ‚΄μ¥) |
| `Environment` μ²λ¦¬ | β μ§μ ‘ μ„¤μ • λ¶κ°€ | β… setActiveProfiles()λ΅ μ„¤μ • κ°€λ¥ |
| κ³ κΈ‰ κΈ°λ¥ μ§€μ› (`@Conditional`, `@Value` λ“±) | β μ—†μ | β… λ€λ¶€λ¶„ μ§€μ› |
| λ©μ  | λ‹¨μν• DI μ©λ„ | μ „μ²΄ μ¤ν”„λ§ μ• ν”λ¦¬μΌ€μ΄μ… μ»¨ν…μ΄λ„ |

---

### π’¬ μ°Έκ³  κ°•μ

- κΉ€μν• - μ¤ν”„λ§ ν•µμ‹¬ μ›λ¦¬ - κΈ°λ³ΈνΈ (μ„Ήμ… 5: μ¤ν”„λ§ μ»¨ν…μ΄λ„μ™€ μ¤ν”„λ§ λΉ)